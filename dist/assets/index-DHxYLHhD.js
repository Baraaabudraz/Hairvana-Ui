import{j as e,Q as le,y as ne,i as _,B,U as M,ac as re,a3 as ie,W as ce,d as de,Y as oe,_ as xe,Z as me,$ as he}from"./ui-vendor-B2pFoMNi.js";import{a as l,L as v}from"./react-vendor-C7H4r9IR.js";import{h as pe,B as r,C as c,d,b as je,I as ue,A as ge,f as Ne,g as fe,D as ve,i as we,j as ye,k as h}from"./index-DyoA978M.js";import{B as w}from"./badge-DN3GUanR.js";import{A as D,a as k,b as A,c as U,d as T,e as F,f as O,g as R}from"./alert-dialog-BRxXeYiA.js";import{f as be,d as Se,u as Ce}from"./users-Bg4EtP47.js";import{f as De}from"./charts-vendor-BwF8VYvl.js";import"./db-vendor-BXl3LOEh.js";import"./data-vendor-CIeUuS6O.js";const ke={super_admin:"bg-purple-100 text-purple-800",admin:"bg-blue-100 text-blue-800",salon:"bg-green-100 text-green-800",user:"bg-gray-100 text-gray-800"},Ae={active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",suspended:"bg-red-100 text-red-800"},Ue={super_admin:re,admin:_,salon:B,user:M},P=(u,x="N/A")=>{if(!u)return x;const n=new Date(u);return isNaN(n.getTime())?x:De(n,{addSuffix:!0})};function Me(){const[u,x]=l.useState([]),[n,I]=l.useState({total:0,admin:0,salon:0,user:0,active:0,pending:0,suspended:0}),[L,E]=l.useState(!0),[g,$]=l.useState(""),[i,N]=l.useState("all"),[o,f]=l.useState("all"),[H,y]=l.useState(!1),[V,b]=l.useState(!1),[W,S]=l.useState(!1),[a,m]=l.useState(null),{toast:p}=pe();l.useEffect(()=>{q()},[i,o,g]);const q=async()=>{try{E(!0);const s={};i!=="all"&&(s.role=i),o!=="all"&&(s.status=o),g&&(s.search=g);const t=await be(s);x(t.users),I(t.stats)}catch(s){console.error("Error loading users:",s),p({title:"Error",description:"Failed to load users. Please try again.",variant:"destructive"})}finally{E(!1)}},z=async(s,t)=>{try{await Ce(s,t),x(te=>te.map(C=>C.id===s?{...C,status:t}:C)),p({title:"Status updated",description:{active:"User has been reactivated",suspended:"User has been suspended",pending:"User status updated to pending"}[t]})}catch{p({title:"Error",description:"Failed to update user status. Please try again.",variant:"destructive"})}},J=async s=>{try{await Se(s),x(t=>t.filter(j=>j.id!==s)),p({title:"User deleted",description:"The user has been permanently removed from the platform."})}catch{p({title:"Error",description:"Failed to delete user. Please try again.",variant:"destructive"})}},Q=s=>{m(s),y(!0)},X=s=>{m(s),b(!0)},Y=s=>{m(s),S(!0)},Z=()=>{a&&(J(a.id),y(!1),m(null))},G=()=>{a&&(z(a.id,"suspended"),b(!1),m(null))},K=()=>{a&&(z(a.id,"active"),S(!1),m(null))},ee=s=>{switch(s){case"super_admin":return"Super Admin";case"admin":return"Admin";case"salon":return"Salon Owner";case"user":return"Customer";default:return s}},se=s=>{switch(s.role){case"admin":case"super_admin":return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.permissions?.length||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Permissions"})]});case"salon":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.totalSalons||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.totalBookings||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Bookings"})]})]});case"user":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["$",s.totalSpent?.toLocaleString()||0]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Spent"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.totalBookings||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Bookings"})]})]});default:return null}},ae=s=>s.role!=="salon"||!s.salons||s.salons.length===0?null:e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.salons.slice(0,2).map(t=>e.jsx(w,{variant:"outline",className:"text-xs",children:t.name},t.id)),s.salons.length>2&&e.jsxs(w,{variant:"outline",className:"text-xs",children:["+",s.salons.length-2," more"]})]})});return L?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage all platform users: admins, salon owners, and customers"})]}),e.jsx(v,{to:"/dashboard/users/new",children:e.jsxs(r,{className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Add New User"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.total}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Users"})]})})}),e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n.admin}),e.jsx("p",{className:"text-xs text-gray-500",children:"Admins"})]})})}),e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.salon}),e.jsx("p",{className:"text-xs text-gray-500",children:"Salon Owners"})]})})}),e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.user}),e.jsx("p",{className:"text-xs text-gray-500",children:"Customers"})]})})}),e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.active}),e.jsx("p",{className:"text-xs text-gray-500",children:"Active"})]})})}),e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:n.pending}),e.jsx("p",{className:"text-xs text-gray-500",children:"Pending"})]})})}),e.jsx(c,{className:"border-0 shadow-sm",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.suspended}),e.jsx("p",{className:"text-xs text-gray-500",children:"Suspended"})]})})})]}),e.jsxs(c,{className:"border-0 shadow-sm",children:[e.jsx(je,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ue,{placeholder:"Search users...",value:g,onChange:s=>$(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{variant:i==="all"?"default":"outline",onClick:()=>N("all"),size:"sm",children:"All Roles"}),e.jsxs(r,{variant:i==="admin"||i==="super_admin"?"default":"outline",onClick:()=>N("admin"),size:"sm",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Admins"]}),e.jsxs(r,{variant:i==="salon"?"default":"outline",onClick:()=>N("salon"),size:"sm",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Salons"]}),e.jsxs(r,{variant:i==="user"?"default":"outline",onClick:()=>N("user"),size:"sm",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Customers"]}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),e.jsx(r,{variant:o==="all"?"default":"outline",onClick:()=>f("all"),size:"sm",children:"All Status"}),e.jsx(r,{variant:o==="active"?"default":"outline",onClick:()=>f("active"),size:"sm",children:"Active"}),e.jsx(r,{variant:o==="pending"?"default":"outline",onClick:()=>f("pending"),size:"sm",children:"Pending"}),e.jsx(r,{variant:o==="suspended"?"default":"outline",onClick:()=>f("suspended"),size:"sm",children:"Suspended"})]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:u.map(s=>{const t=Ue[s.role];return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ge,{className:"h-12 w-12",children:[e.jsx(Ne,{src:s.avatar,alt:s.name}),e.jsx(fe,{children:s.name.split(" ").map(j=>j[0]).join("")})]}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-white rounded-full p-1",children:e.jsx(t,{className:"h-3 w-3 text-gray-600"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("p",{className:"text-xs text-gray-500",children:s.phone})}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ie,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Joined ",P(s.join_date,"Unknown")]}),s.last_login&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"â€¢"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Last seen ",P(s.last_login,"Unknown")]})]})]}),ae(s)]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[se(s),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(w,{className:ke[s.role],children:ee(s.role)}),e.jsx(w,{className:Ae[s.status],children:s.status})]}),e.jsxs(ve,{children:[e.jsx(we,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsxs(ye,{align:"end",children:[e.jsx(h,{asChild:!0,children:e.jsxs(v,{to:`/dashboard/users/${s.id}`,className:"flex items-center w-full",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"View Details"]})}),e.jsx(h,{asChild:!0,children:e.jsxs(v,{to:`/dashboard/users/${s.id}/edit`,className:"flex items-center w-full",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Edit"]})}),s.role==="salon"&&e.jsx(h,{asChild:!0,children:e.jsxs(v,{to:`/dashboard/salons?ownerId=${s.id}`,className:"flex items-center w-full",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"View Salons (",s.salons?.length||0,")"]})}),s.status==="active"&&e.jsxs(h,{className:"text-red-600 cursor-pointer",onClick:()=>X(s),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Suspend"]}),s.status==="suspended"&&e.jsxs(h,{className:"text-green-600 cursor-pointer",onClick:()=>Y(s),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Reactivate"]}),e.jsxs(h,{className:"text-red-600 cursor-pointer",onClick:()=>Q(s),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]},s.id)})})})]}),e.jsx(D,{open:H,onOpenChange:y,children:e.jsxs(k,{children:[e.jsxs(A,{children:[e.jsx(U,{children:"Delete User"}),e.jsxs(T,{children:['Are you sure you want to delete "',a?.name,'"? This action cannot be undone and will permanently remove the user from the platform.',a?.role==="salon"&&a.totalSalons&&a.totalSalons>0&&e.jsxs("span",{className:"block mt-2 text-red-600 font-medium",children:["Warning: This user owns ",a.totalSalons," salon(s). Deleting this user will also affect their salon(s)."]})]})]}),e.jsxs(F,{children:[e.jsx(O,{children:"Cancel"}),e.jsx(R,{onClick:Z,className:"bg-red-600 hover:bg-red-700",children:"Delete User"})]})]})}),e.jsx(D,{open:V,onOpenChange:b,children:e.jsxs(k,{children:[e.jsxs(A,{children:[e.jsx(U,{children:"Suspend User"}),e.jsxs(T,{children:['Are you sure you want to suspend "',a?.name,'"? This will temporarily disable their access to the platform.',a?.role==="salon"&&a.totalSalons&&a.totalSalons>0&&e.jsxs("span",{className:"block mt-2 text-yellow-600 font-medium",children:["Note: This user owns ",a.totalSalons," salon(s). Suspending this user may affect their salon operations."]})]})]}),e.jsxs(F,{children:[e.jsx(O,{children:"Cancel"}),e.jsx(R,{onClick:G,className:"bg-red-600 hover:bg-red-700",children:"Suspend User"})]})]})}),e.jsx(D,{open:W,onOpenChange:S,children:e.jsxs(k,{children:[e.jsxs(A,{children:[e.jsx(U,{children:"Reactivate User"}),e.jsxs(T,{children:['Are you sure you want to reactivate "',a?.name,'"? This will restore their access to the platform.']})]}),e.jsxs(F,{children:[e.jsx(O,{children:"Cancel"}),e.jsx(R,{onClick:K,className:"bg-green-600 hover:bg-green-700",children:"Reactivate User"})]})]})})]})}export{Me as default};
