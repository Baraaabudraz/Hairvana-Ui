import{j as e,a0 as de,y as me,B as V,ac as he,a2 as xe,ah as pe,Z as ue,C as ye,ab as ge}from"./ui-vendor-B2pFoMNi.js";import{u as je,a as l,L as q}from"./react-vendor-C7H4r9IR.js";import{u as be,b as z,h as Ne,n as O,e as R,s as c,l as ve}from"./data-vendor-CIeUuS6O.js";import{h as fe,B as y,C as g,b as j,c as b,e as S,d as N,I as h,A as Z,f as J,g as W,L as x,t as we}from"./index-DyoA978M.js";import{B as _}from"./badge-DN3GUanR.js";import{f as Se}from"./salons-B0SwCEqs.js";import{f as _e,e as G}from"./subscriptions-Ck8TwpZN.js";import"./db-vendor-BXl3LOEh.js";import"./charts-vendor-BwF8VYvl.js";const Ce=z({salon_id:c().min(1,"Please select a salon"),plan_id:c().min(1,"Please select a plan"),billing_cycle:R(["monthly","yearly"]),start_date:c().min(1,"Start date is required"),next_billing_date:c().optional(),amount:O().min(0,"Amount must be positive"),status:R(["active","trial","cancelled","past_due"]).default("active"),payment_method:z({type:ve("card"),cardNumber:c().min(16,"Card number must be 16 digits"),expiryMonth:c().min(1,"Expiry month is required"),expiryYear:c().min(1,"Expiry year is required"),cvv:c().min(3,"CVV must be at least 3 digits"),cardholderName:c().min(2,"Cardholder name is required")}),trial_days:O().min(0).max(30).optional(),auto_renew:Ne().default(!0)}),Le={Basic:pe,Standard:xe,Premium:he},Pe={Basic:"from-gray-600 to-gray-700",Standard:"from-blue-600 to-blue-700",Premium:"from-purple-600 to-purple-700"};function $e(){const K=je(),{toast:p}=fe(),[E,k]=l.useState(!1),[C,L]=l.useState([]),[A,v]=l.useState([]),[u,T]=l.useState(""),[i,F]=l.useState(null),[n,Q]=l.useState(null),[o,X]=l.useState("monthly"),[Ee,ee]=l.useState(!1),[se,M]=l.useState(!0),[Y,ae]=l.useState([]),[te,B]=l.useState(!0),[D,I]=l.useState(null),{register:d,handleSubmit:re,formState:{errors:r},setValue:f,watch:ke}=be({resolver:we(Ce),defaultValues:{billing_cycle:"monthly",start_date:new Date().toISOString().split("T")[0],auto_renew:!0,trial_days:14,salon_id:"",plan_id:"",amount:0,status:"active",payment_method:{type:"card",cardNumber:"",expiryMonth:"",expiryYear:"",cvv:"",cardholderName:""}}});l.useEffect(()=>{(async()=>{try{M(!0);const a=await Se();if(console.log("Loaded salons:",a),a&&a.salons)L(a.salons),v(a.salons);else{console.warn("API returned unexpected structure, using mock data");const t=[{id:"1",name:"Luxe Hair Studio",location:"Beverly Hills, CA",ownerName:"Maria Rodriguez",ownerEmail:"maria@luxehair.com",status:"active",avatar:"https://images.pexels.com/photos/3993449/pexels-photo-3993449.jpeg?auto=compress&cs=tinysrgb&w=800"},{id:"2",name:"Style Cuts",location:"San Francisco, CA",ownerName:"David Chen",ownerEmail:"david@stylecuts.com",status:"active",avatar:"https://images.pexels.com/photos/3993451/pexels-photo-3993451.jpeg?auto=compress&cs=tinysrgb&w=800"},{id:"3",name:"Beauty Haven",location:"Los Angeles, CA",ownerName:"Lisa Thompson",ownerEmail:"lisa@beautyhaven.com",status:"active",avatar:""}];L(t),v(t)}}catch(a){console.error("Error loading salons:",a);const t=[{id:"1",name:"Luxe Hair Studio",location:"Beverly Hills, CA",ownerName:"Maria Rodriguez",ownerEmail:"maria@luxehair.com",status:"active",avatar:"https://images.pexels.com/photos/3993449/pexels-photo-3993449.jpeg?auto=compress&cs=tinysrgb&w=800"},{id:"2",name:"Style Cuts",location:"San Francisco, CA",ownerName:"David Chen",ownerEmail:"david@stylecuts.com",status:"active",avatar:"https://images.pexels.com/photos/3993451/pexels-photo-3993451.jpeg?auto=compress&cs=tinysrgb&w=800"},{id:"3",name:"Beauty Haven",location:"Los Angeles, CA",ownerName:"Lisa Thompson",ownerEmail:"lisa@beautyhaven.com",status:"active",avatar:""}];L(t),v(t),p({title:"Warning",description:"Using demo data. Some features may be limited.",variant:"default"})}finally{M(!1)}})()},[p]),l.useEffect(()=>{const s=C.filter(a=>a.name.toLowerCase().includes(u.toLowerCase())||a.location.toLowerCase().includes(u.toLowerCase())||a.ownerName.toLowerCase().includes(u.toLowerCase()));v(s)},[u,C]);const le=s=>{F(s),f("salon_id",s.id),ee(!1),T("")},ie=s=>{Q(s),f("plan_id",s.id)},U=s=>{X(s),f("billing_cycle",s)},$=()=>n?o==="yearly"?n.yearlyPrice:n.price:0,H=()=>!n||o==="monthly"?0:n.price*12-n.yearlyPrice,ne=async s=>{console.log("Form data:",s),console.log("Selected salon:",i),console.log("Selected plan:",n),k(!0);try{const a=i||C[0],t=n||Y[0];if(!a||!t)throw new Error("Please select a salon and plan");const P=new Date(s.start_date),m=new Date(P);s.billing_cycle==="monthly"?m.setMonth(m.getMonth()+1):m.setFullYear(m.getFullYear()+1);const w={salon_id:a.id,plan_id:t.id,status:s.trial_days&&s.trial_days>0?"trial":"active",start_date:s.start_date,next_billing_date:m.toISOString(),amount:$(),billing_cycle:s.billing_cycle,payment_method:{type:"card",cardNumber:s.payment_method.cardNumber.replace(/\s/g,""),expiryMonth:s.payment_method.expiryMonth,expiryYear:s.payment_method.expiryYear,cvv:s.payment_method.cvv,cardholderName:s.payment_method.cardholderName},usage:{bookingsUsed:0,staffUsed:0,locationsUsed:0,bookingsLimit:t.limits.bookings||0,staffLimit:t.limits.staff||0,locationsLimit:t.limits.locations||0},trial_days:s.trial_days||0,auto_renew:s.auto_renew};console.log("Sending subscription data:",w),await G(w),p({title:"Subscription created successfully",description:`${a.name} has been subscribed to the ${t.name} plan.`}),K("/dashboard/subscriptions")}catch(a){console.error("Error creating subscription:",a);const t=a instanceof Error?a.message:"Please try again later.";p({title:"Error creating subscription",description:t,variant:"destructive"})}finally{k(!1)}};l.useEffect(()=>{oe()},[]);const oe=async()=>{try{B(!0),I(null);const s=await _e();ae(s)}catch{I("Failed to load plans"),p({title:"Error",description:"Failed to load subscription plans. Please try again.",variant:"destructive"})}finally{B(!1)}};return se?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(q,{to:"/dashboard/subscriptions",children:e.jsx(y,{variant:"ghost",size:"icon",children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Subscription"}),e.jsx("p",{className:"text-gray-600",children:"Set up a new subscription plan for a salon"})]})]}),e.jsxs("form",{onSubmit:re(ne),className:"space-y-6",children:[e.jsxs(g,{className:"border-0 shadow-sm",children:[e.jsxs(j,{children:[e.jsx(b,{children:"Select Salon"}),e.jsx(S,{children:"Choose the salon that will receive this subscription"})]}),e.jsxs(N,{className:"space-y-4",children:[i?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Z,{className:"h-12 w-12",children:[e.jsx(J,{src:i.avatar,alt:i.name}),e.jsx(W,{children:i.name.split(" ").map(s=>s[0]).join("")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600",children:i.location}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.ownerName," • ",i.ownerEmail]})]})]}),e.jsx(y,{type:"button",variant:"outline",onClick:()=>{F(null),f("salon_id","")},children:"Change Salon"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(h,{placeholder:"Search salons by name, location, or owner...",value:u,onChange:s=>T(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:A.map(s=>e.jsxs("div",{onClick:()=>le(s),className:"flex items-center gap-4 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsxs(Z,{className:"h-10 w-10",children:[e.jsx(J,{src:s.avatar,alt:s.name}),e.jsx(W,{children:s.name.split(" ").map(a=>a[0]).join("")})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.location}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.ownerName," • ",s.ownerEmail]})]}),e.jsx(_,{variant:"outline",children:"Available"})]},s.id))}),A.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No available salons found"}),e.jsx("p",{className:"text-sm",children:"All salons may already have active subscriptions"})]})]}),r.salon_id&&e.jsx("p",{className:"text-sm text-red-500",children:r.salon_id.message})]})]}),e.jsxs(g,{className:"border-0 shadow-sm",children:[e.jsxs(j,{children:[e.jsx(b,{children:"Choose Subscription Plan"}),e.jsx(S,{children:"Select the plan that best fits the salon's needs"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsxs("div",{className:"bg-gray-100 p-1 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>U("monthly"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="monthly"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Monthly"}),e.jsxs("button",{type:"button",onClick:()=>U("yearly"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="yearly"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Yearly",e.jsx(_,{className:"ml-2 bg-green-100 text-green-800",children:"Save up to 17%"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:te?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Loading plans..."})]}):D?e.jsx("div",{className:"text-center py-8 text-red-500",children:e.jsx("p",{children:D})}):Y.map(s=>{const a=Le[s.name],t=n?.id===s.id,P=o==="yearly"?s.yearlyPrice:s.price,m=o==="yearly"?s.price*12-s.yearlyPrice:0;return e.jsxs("div",{onClick:()=>ie(s),className:`relative p-6 rounded-lg border-2 cursor-pointer transition-all ${t?"border-purple-200 bg-purple-50 shadow-lg":s.popular?"border-blue-200 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[s.popular&&!t&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(_,{className:"bg-blue-600 text-white",children:"Most Popular"})}),t&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(_,{className:"bg-purple-600 text-white",children:"Selected"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:`p-3 rounded-lg bg-gradient-to-r ${Pe[s.name]}`,children:e.jsx(a,{className:"h-6 w-6 text-white"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"text-gray-600 mt-2",children:s.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["$",P]}),e.jsxs("span",{className:"text-gray-600",children:["/",o==="yearly"?"year":"month"]})]}),o==="yearly"&&m>0&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Save $",m.toFixed(2)," per year"]})]}),e.jsx("ul",{className:"mt-6 space-y-3",children:s.features.map((w,ce)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:w})]},ce))})]},s.id)})}),r.plan_id&&e.jsx("p",{className:"text-sm text-red-500 mt-4",children:r.plan_id.message})]})]}),e.jsxs(g,{className:"border-0 shadow-sm",children:[e.jsxs(j,{children:[e.jsx(b,{children:"Subscription Details"}),e.jsx(S,{children:"Configure the subscription settings"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(h,{id:"start_date",type:"date",...d("start_date")}),r.start_date&&e.jsx("p",{className:"text-sm text-red-500",children:r.start_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"trial_days",children:"Trial Period (Days)"}),e.jsx(h,{id:"trial_days",type:"number",min:"0",max:"30",placeholder:"14",...d("trial_days",{valueAsNumber:!0})}),e.jsx("p",{className:"text-xs text-gray-500",children:"0-30 days trial period"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"auto_renew",...d("auto_renew"),className:"rounded"}),e.jsx(x,{htmlFor:"auto_renew",className:"text-sm",children:"Enable automatic renewal"})]})]})]}),e.jsxs(g,{className:"border-0 shadow-sm",children:[e.jsxs(j,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Payment Information"]}),e.jsx(S,{children:"Enter the payment details for this subscription"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"cardholderName",children:"Cardholder Name *"}),e.jsx(h,{id:"cardholderName",placeholder:"John Doe",...d("payment_method.cardholderName")}),r.payment_method?.cardholderName&&e.jsx("p",{className:"text-sm text-red-500",children:r.payment_method.cardholderName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"cardNumber",children:"Card Number *"}),e.jsx(h,{id:"cardNumber",placeholder:"1234 5678 9012 3456",maxLength:19,...d("payment_method.cardNumber")}),r.payment_method?.cardNumber&&e.jsx("p",{className:"text-sm text-red-500",children:r.payment_method.cardNumber.message})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"expiryMonth",children:"Month *"}),e.jsx(h,{id:"expiryMonth",placeholder:"MM",maxLength:2,...d("payment_method.expiryMonth")}),r.payment_method?.expiryMonth&&e.jsx("p",{className:"text-sm text-red-500",children:r.payment_method.expiryMonth.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"expiryYear",children:"Year *"}),e.jsx(h,{id:"expiryYear",placeholder:"YYYY",maxLength:4,...d("payment_method.expiryYear")}),r.payment_method?.expiryYear&&e.jsx("p",{className:"text-sm text-red-500",children:r.payment_method.expiryYear.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"cvv",children:"CVV *"}),e.jsx(h,{id:"cvv",placeholder:"123",maxLength:4,...d("payment_method.cvv")}),r.payment_method?.cvv&&e.jsx("p",{className:"text-sm text-red-500",children:r.payment_method.cvv.message})]})]})]})]}),i&&n&&e.jsxs(g,{className:"border-0 shadow-sm bg-gradient-to-r from-purple-50 to-pink-50",children:[e.jsx(j,{children:e.jsx(b,{children:"Subscription Summary"})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Salon:"}),e.jsx("span",{className:"font-semibold",children:i.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Plan:"}),e.jsx("span",{className:"font-semibold",children:n.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Billing:"}),e.jsx("span",{className:"font-semibold capitalize",children:o})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-semibold text-lg",children:["$",$()]})]}),o==="yearly"&&H()>0&&e.jsxs("div",{className:"flex items-center justify-between text-green-600",children:[e.jsx("span",{children:"Annual Savings:"}),e.jsxs("span",{className:"font-semibold",children:["$",H().toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(q,{to:"/dashboard/subscriptions",children:e.jsx(y,{variant:"outline",type:"button",children:"Cancel"})}),e.jsx(y,{type:"button",variant:"outline",onClick:async()=>{try{const s={salon_id:"1",plan_id:"basic",status:"active",start_date:new Date().toISOString().split("T")[0],next_billing_date:new Date(Date.now()+2592e6).toISOString(),amount:19.99,billing_cycle:"monthly",payment_method:{type:"card",cardNumber:"1234567890123456",expiryMonth:"12",expiryYear:"2025",cvv:"123",cardholderName:"Test User"},usage:{bookingsUsed:0,staffUsed:0,locationsUsed:0,bookingsLimit:100,staffLimit:3,locationsLimit:1},trial_days:0,auto_renew:!0};console.log("Testing with data:",s),await G(s),p({title:"Test successful",description:"Subscription created successfully!"})}catch(s){console.error("Test failed:",s),p({title:"Test failed",description:s instanceof Error?s.message:"Unknown error",variant:"destructive"})}},children:"Test API"}),e.jsxs(y,{type:"submit",disabled:E,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),E?"Creating Subscription...":"Create Subscription"]})]})]})]})}export{$e as default};
